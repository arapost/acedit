= Introduction =

This page lists all the changes that were done over the generated GMF code for both the GSN and ARM diagrams. The purpose of the modification of the generated code was to satisfy the requirements in order to reach the desired result. 

= Changes over the generated GMF code for GSN=

This sections lists the modifications over the generated code for GSN. The reasons of modifications are explained following by the code that was added/replaced in specific classes.

== Modifications over the GSN edit parts==

The default functionality for modifying the displaying of GSN diagrams did not permit to change the appearance of an element according to changes in its attributes. That wasn’t sufficient, since elements such as the Goal has to render differently according to its status that is related with the GSN extensions (public, undeveloped etc ). The following modification were done:

=== !AssumptionEditPart.java ===
In package GSN1.diagram.edit.parts
Java file: !AssumptionEditPart.java

 * the method: protected void handleNotificationEvent(Notification event) was replaced with the following:

{{{
@Override
	protected void handleNotificationEvent(Notification event) {
		  if (event.getNotifier() == getModel()
			      && EcorePackage.eINSTANCE.getEModelElement_EAnnotations()
			          .equals(event.getFeature())) {
			    handleMajorSemanticChange();
			  } else {

			    if (event.getNotifier() instanceof Assumption) {
			     
			    	Assumption assumption = (Assumption) ( (Node) this.getModel()).getElement();
			    	
			    	if (assumption.getTobeinstantiated()==true){ 
			    		AssumptionFigure figure = (AssumptionFigure) this.getPrimaryShape();
				    	  figure.setShape(1);
				  	}
			  		else{
			  			AssumptionFigure figure = (AssumptionFigure) this.getPrimaryShape();
				    	  figure.setShape(0);
			  		}
			    
			    }
			    super.handleNotificationEvent(event);
			  }
	}

}}}

 * the method: protected IFigure createNodeShape() was replaced with the following:

{{{
/**
	 * @generated NOT
	 */
	protected IFigure createNodeShape() {
		Assumption assumption = (Assumption) ( (Node) this.getModel()).getElement();
  		if (assumption.getTobeinstantiated()==true){ 
  			primaryShape = new AssumptionFigure();
  			((AssumptionFigure)(primaryShape)).setShape(1);
  		}
  		
  		else{
  			primaryShape = new AssumptionFigure();
  		}
  		return primaryShape;
	}
}}}

=== !ContextEditPart.java ===
In package GSN1.diagram.edit.parts
Java file: !ContextEditPart.java

 * the method: protected void handleNotificationEvent(Notification event) was replaced with the following:
{{{
@Override
	protected void handleNotificationEvent(Notification event) {
		  if (event.getNotifier() == getModel()
			      && EcorePackage.eINSTANCE.getEModelElement_EAnnotations()
			          .equals(event.getFeature())) {
			    handleMajorSemanticChange();
			  } else {

			    if (event.getNotifier() instanceof Context) {
			     
			    	Context context = (Context) ( (Node) this.getModel()).getElement();
			    	
			    	if (context.getTobeinstantiated()==true){ 
			    		ContextFigure figure = (ContextFigure) this.getPrimaryShape();
				    	  figure.setShape(1);
				  	}
			  		else{
			  			ContextFigure figure = (ContextFigure) this.getPrimaryShape();
				    	  figure.setShape(0);
			  		}
			    	if(context.getVisibility()==ElementVisibility.PUBLIC){
			    		ContextFigure figure = (ContextFigure) this.getPrimaryShape();
			    		figure.setVisibility(true);
			    	}
			    	else{
			    		ContextFigure figure = (ContextFigure) this.getPrimaryShape();
			    		figure.setVisibility(false);
			    	}
			    }
			    super.handleNotificationEvent(event);
			  }
	}
}}}

 * the method: protected IFigure createNodeShape() was replaced with the following:
{{{

		/**
	 * @generated NOT
	 */
	protected IFigure createNodeShape() {
		Context context = (Context) ( (Node) this.getModel()).getElement();
  		if (context.getTobeinstantiated()==true){ 
  			primaryShape = new ContextFigure();
  			((ContextFigure)(primaryShape)).setShape(1);
  		}
  		
  		else{
  			primaryShape = new ContextFigure();
  		}
  		if(context.getVisibility()==ElementVisibility.PUBLIC)
  			((ContextFigure)(primaryShape)).setVisibility(true);

  		return primaryShape;
	}
}}}

=== !GoalEditPart.java ===
In package GSN1.diagram.edit.parts
Java file: !GoalEditPart.java

 * the method: protected void handleNotificationEvent(Notification event) was replaced with the following:
{{{
@Override
	protected void handleNotificationEvent(Notification event) {
		if (event.getNotifier() == getModel()
				&& EcorePackage.eINSTANCE.getEModelElement_EAnnotations()
						.equals(event.getFeature())) {
			handleMajorSemanticChange();
		} else {

			if (event.getNotifier() instanceof Goal) {

				Goal goal = (Goal) ((Node) this.getModel()).getElement();
				if (goal.getToBeDeveloped() == true
						&& goal.getTobeinstantiated() == false) {
					GoalFigure figure = (GoalFigure) this.getPrimaryShape();
					figure.setShape(1);
				} else if (goal.getToBeDeveloped() == false
						&& goal.getTobeinstantiated() == true) {
					GoalFigure figure = (GoalFigure) this.getPrimaryShape();
					figure.setShape(2);
				} else if (goal.getToBeDeveloped() == true
						&& goal.getTobeinstantiated() == true) {
					GoalFigure figure = (GoalFigure) this.getPrimaryShape();
					figure.setShape(3);
				} else if(goal.getToBeSupportedByContract() == true){
					GoalFigure figure = (GoalFigure) this.getPrimaryShape();
					figure.setShape(4);
				}
				else {
					GoalFigure figure = (GoalFigure) this.getPrimaryShape();
					figure.setShape(0);
				}
				if (goal.getVisibility() == ElementVisibility.PUBLIC) {
					GoalFigure figure = (GoalFigure) this.getPrimaryShape();
					figure.setVisibility(true);
				} else {
					GoalFigure figure = (GoalFigure) this.getPrimaryShape();
					figure.setVisibility(false);
				}
			}
			super.handleNotificationEvent(event);
		}
	}
}}}

 * the method: protected IFigure createNodeShape() was replaced with the following:
{{{
/**
	 * @generated NOT
	 */
	protected IFigure createNodeShape() {
		Goal goal = (Goal) ( (Node) this.getModel()).getElement();
  		if (goal.getToBeDeveloped()==true && goal.getTobeinstantiated()==false){ 
  			primaryShape = new GoalFigure();
  			((GoalFigure)(primaryShape)).setShape(1);
  			
  		}
  		else if (goal.getTobeinstantiated()==true && goal.getToBeDeveloped()==false){ 
  			primaryShape = new GoalFigure();
  			((GoalFigure)(primaryShape)).setShape(2);

  		}
  		else if (goal.getToBeDeveloped()==true && goal.getTobeinstantiated()==true){ 
  			primaryShape = new GoalFigure();
  			((GoalFigure)(primaryShape)).setShape(3);
  		}
  		else if(goal.getToBeSupportedByContract()==true){
  			primaryShape = new GoalFigure();
  			((GoalFigure)(primaryShape)).setShape(4);
  		}
  		else{
  			primaryShape = new GoalFigure();
  		}
  		if(goal.getVisibility()==ElementVisibility.PUBLIC)
  			((GoalFigure)(primaryShape)).setVisibility(true);

  		return primaryShape;
	}
}}}

=== !JustificationEditPart.java ===
In package GSN1.diagram.edit.parts
Java file: !JustificationEditPart.java

 * the method: protected void handleNotificationEvent(Notification event) was replaced with the following:
{{{
	@Override
	protected void handleNotificationEvent(Notification event) {
		  if (event.getNotifier() == getModel()
			      && EcorePackage.eINSTANCE.getEModelElement_EAnnotations()
			          .equals(event.getFeature())) {
			    handleMajorSemanticChange();
			  } else {

			    if (event.getNotifier() instanceof Justification) {
			     
			    	Justification justification = (Justification) ( (Node) this.getModel()).getElement();
			    	
			    	if (justification.getTobeinstantiated()==true){ 
			    		JustificationFigure figure = (JustificationFigure) this.getPrimaryShape();
				    	  figure.setShape(1);
				  	}
			  		else{
			  			JustificationFigure figure = (JustificationFigure) this.getPrimaryShape();
				    	  figure.setShape(0);
			  		}
			    
			    }
			    super.handleNotificationEvent(event);
			  }
	}

}}}

 * the method: protected IFigure createNodeShape() was replaced with the following:
{{{
/**
	 * @generated NOT
	 */
	protected IFigure createNodeShape() {
		Justification justification = (Justification) ( (Node) this.getModel()).getElement();
  		if (justification.getTobeinstantiated()==true){ 
  			primaryShape = new JustificationFigure();
  			((JustificationFigure)(primaryShape)).setShape(1);
  		}
  		
  		else{
  			primaryShape = new JustificationFigure();
  		}
  		return primaryShape;
	}
}}}

=== !SolutionEditPart.java ===
In package GSN1.diagram.edit.parts
Java file: !SolutionEditPart.java

 * the method: protected void handleNotificationEvent(Notification event) was replaced with the following:
{{{
	@Override
	protected void handleNotificationEvent(Notification event) {
		  if (event.getNotifier() == getModel()
			      && EcorePackage.eINSTANCE.getEModelElement_EAnnotations()
			          .equals(event.getFeature())) {
			    handleMajorSemanticChange();
			  } else {

			    if (event.getNotifier() instanceof Solution) {
			     
			    	Solution solution = (Solution) ( (Node) this.getModel()).getElement();
			    	
			    	if (solution.getTobeinstantiated()==true){ 
			    		SolutionFigure figure = (SolutionFigure) this.getPrimaryShape();
				    	  figure.setShape(1);
				  	}
			  		else{
			  			SolutionFigure figure = (SolutionFigure) this.getPrimaryShape();
				    	  figure.setShape(0);
			  		}
			    	if(solution.getVisibility()==ElementVisibility.PUBLIC){
			    		SolutionFigure figure = (SolutionFigure) this.getPrimaryShape();
			    		figure.setVisibility(true);
			    	}
			    	else{
			    		SolutionFigure figure = (SolutionFigure) this.getPrimaryShape();
			    		figure.setVisibility(false);
			    	}
			    }
			    super.handleNotificationEvent(event);
			  }
	}

}}}

 * the method: protected IFigure createNodeShape() was replaced with the following:
{{{
/**
	 * @generated NOT
	 */
	protected IFigure createNodeShape() {
		Solution solution = (Solution) ( (Node) this.getModel()).getElement();
  		if (solution.getTobeinstantiated()==true){ 
  			primaryShape = new SolutionFigure();
  			((SolutionFigure)(primaryShape)).setShape(1);
  		}
  		
  		else{
  			primaryShape = new SolutionFigure();
  		}
  		if(solution.getVisibility()==ElementVisibility.PUBLIC)
  			((SolutionFigure)(primaryShape)).setVisibility(true);

  		return primaryShape;
	}
}}}


=== !StradegyEditPart.java ===
In package GSN1.diagram.edit.parts
Java file: !StradegyEditPart.java

 * the method: protected void handleNotificationEvent(Notification event) was replaced with the following:
{{{
		@Override
	protected void handleNotificationEvent(Notification event) {
		  if (event.getNotifier() == getModel()
			      && EcorePackage.eINSTANCE.getEModelElement_EAnnotations()
			          .equals(event.getFeature())) {
			    handleMajorSemanticChange();
			  } else {

			    if (event.getNotifier() instanceof Strategy) {
			     
			    	Strategy strategy = (Strategy) ( (Node) this.getModel()).getElement();
			    	if (strategy.getToBeDeveloped()==true && strategy.getTobeinstantiated()==false){ 
			    	StrategyFigure figure = (StrategyFigure) this.getPrimaryShape();
			    	  figure.setShape(1);
			  		}
			    	else if (strategy.getToBeDeveloped()==false && strategy.getTobeinstantiated()==true){ 
			    		StrategyFigure figure = (StrategyFigure) this.getPrimaryShape();
				    	  figure.setShape(2);
				  	}
			    	else if (strategy.getToBeDeveloped()==true && strategy.getTobeinstantiated()==true){ 
			    		StrategyFigure figure = (StrategyFigure) this.getPrimaryShape();
				    	  figure.setShape(3);
				  	}
			  		else{
			  			StrategyFigure figure = (StrategyFigure) this.getPrimaryShape();
				    	  figure.setShape(0);
			  		}
			    	
			    }
			    super.handleNotificationEvent(event);
			  }
	}

}}}

 * the method: protected IFigure createNodeShape() was replaced with the following:
{{{
/**
	 * @generated NOT
	 */
	protected IFigure createNodeShape() {
		Strategy strategy = (Strategy) ( (Node) this.getModel()).getElement();
  		if (strategy.getToBeDeveloped()==true && strategy.getTobeinstantiated()==false){ 
  			primaryShape = new StrategyFigure();
  			((StrategyFigure)(primaryShape)).setShape(1);
  			
  		}
  		else if (strategy.getTobeinstantiated()==true && strategy.getToBeDeveloped()==false){ 
  			primaryShape = new StrategyFigure();
  			((StrategyFigure)(primaryShape)).setShape(2);

  		}
  		else if (strategy.getToBeDeveloped()==true && strategy.getTobeinstantiated()==true){ 
  			primaryShape = new StrategyFigure();
  			((StrategyFigure)(primaryShape)).setShape(3);
  		}
  		else{
  			primaryShape = new StrategyFigure();
  		}

  		return primaryShape;
	}
}}}

=== !SolvedByEditPart.java ===

In package GSN1.diagram.edit.parts
Java file: !SolvedByEditPart.java

 * The following method was added:
{{{

/**
	 * @generated NOT
	 */
	@Override
	protected void handleNotificationEvent(Notification event) {
		  if (event.getNotifier() == getModel()
			      && EcorePackage.eINSTANCE.getEModelElement_EAnnotations()
			          .equals(event.getFeature())) {
			    handleMajorSemanticChange();
			  } else {

			    if (event.getNotifier() instanceof SolvedBy) {
			     
			    	SolvedBy solvedBy = (SolvedBy) ((View) this.getModel()).getElement();
			    	if (solvedBy.getMultiextension()==SolvedByMultiplicityExtension.OPTIONAL ){ 
			    		SolvedByFigure figure = (SolvedByFigure) this.getPrimaryShape();
			    	  figure.setShape(1);
			        solvedBy.setCardinality("");

			  		}
			    	else if (solvedBy.getMultiextension()==SolvedByMultiplicityExtension.MULTI ){ 
			    		SolvedByFigure figure = (SolvedByFigure) this.getPrimaryShape();
				    	  figure.setShape(2);
				

				  	}
			  		else{
			  			SolvedByFigure figure = (SolvedByFigure) this.getPrimaryShape();
				    	  figure.setShape(0);
					solvedBy.setCardinality("");

			  		}
			    
			    }
			    super.handleNotificationEvent(event);
			  }
	}

}}}

* The method: protected Connection createConnectionFigure() was replaced by the following:
{{{
/**
	 * Creates figure for this edit part.
	 * 
	 * Body of this method does not depend on settings in generation model
	 * so you may safely remove <i>generated</i> tag and modify it.
	 * 
	 * @generated NOT
	 */

	protected Connection createConnectionFigure() {
		SolvedBy solvedBy = (SolvedBy) ((View) this.getModel()).getElement();
		SolvedByFigure figure;
		if (solvedBy.getMultiextension()==SolvedByMultiplicityExtension.OPTIONAL ){ 
    		figure = new SolvedByFigure();
    		figure.setShape(1);
  		}
    	else if (solvedBy.getMultiextension()==SolvedByMultiplicityExtension.MULTI){ 
    		figure = new SolvedByFigure();
    		figure.setShape(2);
	  	}
  		else{
  			figure = new SolvedByFigure();
    		figure.setShape(0);
  		}
		return  figure;
	}
}}}

 * The lines: 
{{{
/**
	 * @generated 
	 */
	public class SolvedByFigure extends PolylineConnectionEx{
}}}

 were replaced by:
{{{
/**
	 * @generated NOT
	 */
	public class SolvedByFigure extends GSNSolvedBy {

}}}

== Modifications for the default delete from keyboard behaviour ==

The default functionality for delete from the keyboard supported by the generated code wasn’t sufficient, since the element was deleted only from the diagram view and not from the model view delete. The following modification were done:

=== GSN1DiagramEditor.java ===
In package GSN1.diagram.part
Java file: !GSN1DiagramEditor.java

the method protected void configureGraphicalViewer() was replaced by:
{{{
/**
	 * @generated NOT
	 */
	protected void configureGraphicalViewer() {
		super.configureGraphicalViewer();
		DiagramEditorContextMenuProvider provider = new DiagramEditorContextMenuProvider(
				this, getDiagramGraphicalViewer());
		getDiagramGraphicalViewer().setContextMenu(provider);
		getSite().registerContextMenu(ActionIds.DIAGRAM_EDITOR_CONTEXT_MENU,
				provider, getDiagramGraphicalViewer());
		KeyHandler keyHandler = getDiagramGraphicalViewer().getKeyHandler();
		keyHandler.put(
		    KeyStroke.getPressed(SWT.DEL, 127, 0),
		    getActionRegistry().getAction(
		        ActionIds.ACTION_DELETE_FROM_MODEL
		    )
		);
		keyHandler.put(
		    KeyStroke.getPressed(SWT.BS, 8, 0),
		    getActionRegistry().getAction(
		        ActionIds.ACTION_DELETE_FROM_MODEL
		    )
		);
	}
}}}

== Modifications for the delete behaviour when an Argument or Contract module is deleted==
 
By default when the user deletes an element, including the ArgumentModule and the ContractModule elements, nothing else is deleted. In the case of GSN diagrams, we wanted to add the following functionality: when the user deletes an argument or contract module we want also the elements that belong to this modules to be deleted. The reason was that there is that it make sense when a user deletes an Argument module to also delete all the contained elements. For this reason the following modifications were done: 

=== !ArgumentModuleItemSemanticEditPolicy.java ===

In package GSN1.diagram.edit.policies
Java file: !ArgumentModuleItemSemanticEditPolicy.java

 * in the method protected Command getDestroyElementCommand(DestroyElementRequest req), the following code was added before the return statement: 
{{{
ArgumentModule ar=(ArgumentModule)view.getElement();
		for(int i=0;i<ar.getContainsElement().size();i++){
			DestroyElementRequest r = new DestroyElementRequest(
					ar.getContainsElement().get(i), false);
			cmd.add(new DestroyElementCommand(r));
		}
}}} 


=== !ContractModuleItemSemanticEditPolicy.java ===

In package GSN1.diagram.edit.policies
Java file: !ContractModuleItemSemanticEditPolicy.java

 * in the method protected Command getDestroyElementCommand(DestroyElementRequest req), the following code was added before the return statement: 
{{{
ContractModule ar=(ContractModule)view.getElement();
		for(int i=0;i<ar.getContainsElement().size();i++){
			DestroyElementRequest r = new DestroyElementRequest(
					ar.getContainsElement().get(i), false);
			cmd.add(new DestroyElementCommand(r));
		}
}}} 